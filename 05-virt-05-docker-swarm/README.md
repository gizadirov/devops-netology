# Домашнее задание к занятию 5. «Оркестрация кластером Docker контейнеров на примере Docker Swarm»## Задача 1Дайте письменые ответы на вопросы:- В чём отличие режимов работы сервисов в Docker Swarm-кластере: replication и global?- Какой алгоритм выбора лидера используется в Docker Swarm-кластере?- Что такое Overlay Network?## Ответ#### В чём отличие режимов работы сервисов в Docker Swarm-кластере: replication и global?Global означает, что данный сервис будет запущен ровно в одном экземпляре на всех возможных нодах. А replication (задан по умолчанию) означает, что n-ое кол-во контейнеров для данного сервиса будет запущено на всех доступных нодах.#### Какой алгоритм выбора лидера используется в Docker Swarm-кластере?Raft. Этот алгоритм обеспечивает согласованное состояние кластера. Raft требует, чтобы большинство членов кластера согласились на изменение, и допускает (N-1)/2 сбоев. В случае недоступности лидера, его роль берет на себя одна из нод-менеджеров (если за нее проголосовало большинство менеджеров). Реализуется это за счет таймаутов. Если в течение определенного времени менеджер не получил данные от лидера - он объявляет себя кандидатом и другие ноды голосуют за него.#### Что такое Overlay Network?Overlay-сеть создает подсеть, которую могут использовать контейнеры в разных хостах swarm-кластера. Контейнеры на разных физических хостах могут обмениваться данными по overlay-сети (если все они прикреплены к одной сети).## Задача 2Создайте ваш первый Docker Swarm-кластер в Яндекс Облаке.Чтобы получить зачёт, предоставьте скриншот из терминала (консоли) с выводом команды:```docker node ls```## Ответ```timur@node01:~$ sudo docker node lsID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSIONa6e9js3g3fy19yolxuhpwu6dk *   node01     Ready     Active         Leader           20.10.5+dfsg1r2aco55p9a8qnm48v5ajz6g2n     node02     Ready     Active         Reachable        20.10.5+dfsg1l9gazygwi80mjh4qtvzqhfhd7     node03     Ready     Active         Reachable        20.10.5+dfsg1qu8qc1ppbein7tw869mhr17l8     node04     Ready     Active                          20.10.5+dfsg13jgrft8hko2h7snl7ja016dm7     node05     Ready     Active                          20.10.5+dfsg1vu998pophxzyin0ksckj9eu50     node06     Ready     Active                          20.10.5+dfsg1```## Задача 3Создайте ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.Чтобы получить зачёт, предоставьте скриншот из терминала (консоли), с выводом команды:```docker service ls```## Ответ```commandline    timur@node01:~$ sudo docker service ls    ID             NAME                                MODE         REPLICAS   IMAGE                                          PORTS    x03a2h68fq6n   swarm_monitoring_alertmanager       replicated   1/1        stefanprodan/swarmprom-alertmanager:v0.14.0    n4b4v3lox4uy   swarm_monitoring_caddy              replicated   1/1        stefanprodan/caddy:latest                      *:3000->3000/tcp, *:9090->9090/tcp, *:9093-9094->9093-9094/tcp    xx6wtcdqco10   swarm_monitoring_cadvisor           global       0/0        google/cadvisor:latest    jlnnupjaax9d   swarm_monitoring_dockerd-exporter   global       6/6        stefanprodan/caddy:latest    kfwvv3r4ne9u   swarm_monitoring_grafana            replicated   1/1        stefanprodan/swarmprom-grafana:5.3.4    yj7k6mi6vcyu   swarm_monitoring_node-exporter      global       6/6        stefanprodan/swarmprom-node-exporter:v0.16.0    sh2umv5693m7   swarm_monitoring_prometheus         replicated   1/1        stefanprodan/swarmprom-prometheus:v2.5.0    at026vqvh1jj   swarm_monitoring_unsee              replicated   1/1        cloudflare/unsee:v0.8.0```## Задача 4 (*)Выполните на лидере Docker Swarm-кластера команду, указанную ниже, и дайте письменное описание её функционала — что она делает и зачем нужна:```# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/docker swarm update --autolock=true```## ОтветДанная команда нужна для включения автоблокировки Swarm после перезагрузки ноды.Когда демон Docker перезапускается, ключи шифрования журналов Raft и ключи TLS для взаимодействия серверов загружаются в память каждой ноды. Чтобы защитить эти ключи, Docker может включить механизм блокировки ноды (по сути шифрование этих ключей).После активации данного механизма при перезагрузке ноды необходимо каждый раз вводить вручную ключ шифрования, чтобы нода успешно запустилась и продолжила работу в составе кластера.```commandlinetimur@node01:~$ sudo docker swarm update --autolock=trueSwarm updated.To unlock a swarm manager after it restarts, run the `docker swarm unlock`command and provide the following key:    SWMKEY-1-Gn2S5YlR/DjoxZdx6cyfLR9wTfguyFHQ5gn4rc+d9JQPlease remember to store this key in a password manager, since without it youwill not be able to restart the manager.```